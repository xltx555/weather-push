name: Daily Weather Push

on:
  workflow_dispatch:  # 手动触发
  schedule:
    # 定时任务：每天8点、12点、22点（UTC时间，对应北京时间+8小时，实际为16:00、20:00、次日4:00，可根据需求调整）
    - cron: '0 0,4,14 * * *'

jobs:
  send_weather:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # 指定Python版本，避免兼容性问题

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests schedule

      - name: Run script
        env:
          # 系统编码强制配置，解决ASCII编码报错
          LC_ALL: zh_CN.UTF-8
          LANG: zh_CN.UTF-8
          PYTHONIOENCODING: utf-8
          # 从GitHub Secrets读取敏感配置
          WEATHER_KEY: ${{ secrets.WEATHER_KEY }}
          WEATHER_HOST: ${{ secrets.WEATHER_HOST }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PWD: ${{ secrets.SMTP_PWD }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
        run: python main.py
